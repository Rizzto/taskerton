<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Username Demo</title>
<meta name="description" content="Simple static site to test GitHub → Netlify deployment with a shared username bar using Netlify Functions + Blobs." />
<style>
:root{--bg:#0b1020;--card:#131a2a;--muted:#94a3b8;--text:#e9eef5}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Cantarell,Helvetica Neue,Arial,Noto Sans,sans-serif;background:radial-gradient(1200px 600px at 80% -10%,#1b2540 0,#0b1020 40%),var(--bg);color:var(--text);min-height:100svh;display:grid;place-items:center;padding:24px}
.card{background:var(--card);border:1px solid #1f2a44;border-radius:16px;padding:24px;width:min(560px,100%);box-shadow:0 6px 24px rgba(0,0,0,.35)}
h1{margin:0 0 8px;font-size:24px}
p{margin:0 0 16px;color:var(--muted)}
label{display:block;margin:0 0 8px;font-weight:600}
.row{display:flex;gap:8px}
input[type="text"]{flex:1;padding:12px 14px;border-radius:12px;border:1px solid #22304f;background:#0d1424;color:var(--text);outline:none}
button{padding:12px 16px;border-radius:12px;border:1px solid #2a3b63;background:linear-gradient(#1f2f52,#16233e);color:var(--text);font-weight:600;cursor:pointer}
button:disabled{opacity:.6;cursor:not-allowed}
.small{font-size:12px;color:#94a3b8;margin-top:8px}
.output{margin-top:16px;font-size:18px;font-weight:600;min-height:28px}
.bar{margin-top:14px;padding-top:12px;border-top:1px solid #1f2a44}
.chips{display:flex;gap:8px;overflow:auto;padding-bottom:4px}
.chip{padding:6px 10px;border-radius:999px;background:#0d1424;border:1px solid #22304f;white-space:nowrap;font-size:12px;color:#cbd5e1}
footer{margin-top:20px;font-size:12px;color:#94a3b8}
a{color:#9ec1ff}
</style>
</head>
<body>
  <main class="card">
    <h1>Username Demo</h1>
    <p>Enter any username to see it reflected instantly. This also pushes it to a shared list so others see it, too.</p>
    <form id="form" autocomplete="off">
      <label for="username">Username</label>
      <div class="row">
        <input id="username" name="username" type="text" placeholder="e.g. Nightblade42" required minlength="2" maxlength="30" />
        <button id="submit" type="submit">Submit</button>
      </div>
      <div class="small">Stored locally for you and globally via Netlify Functions + Blobs.</div>
    </form>
    <div id="output" class="output" aria-live="polite"></div>
    <div class="bar" id="user-bar" hidden>
      <div class="small" style="margin-bottom:6px;">Recent usernames</div>
      <div id="chips" class="chips" aria-live="polite"></div>
    </div>
    <footer>
      <span>Built for a quick GitHub → Netlify smoke test.</span>
    </footer>
  </main>
<script>
(function() {
  const form = document.getElementById('form');
  const input = document.getElementById('username');
  const out = document.getElementById('output');
  const chips = document.getElementById('chips');
  const bar = document.getElementById('user-bar');

  // Load saved username if available
  const saved = localStorage.getItem('username_demo');
  if (saved) {
    input.value = saved;
    out.textContent = 'Hello, ' + saved + '!';
  }

  async function refreshBar() {
    // The endpoint exists only when deployed on Netlify or running `netlify dev`
    const endpoint = '/.netlify/functions/usernames';
    try {
      const resp = await fetch(endpoint, { method: 'GET' });
      if (!resp.ok) throw new Error('Bad status');
      const data = await resp.json();
      const list = (data && data.usernames) || [];
      chips.innerHTML = '';
      list.forEach(entry => {
        const div = document.createElement('div');
        div.className = 'chip';
        div.textContent = entry.name;
        chips.appendChild(div);
      });
      bar.hidden = list.length === 0;
    } catch (err) {
      // If the function is not available (e.g., opened from filesystem), just hide the bar.
      bar.hidden = true;
    }
  }

  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    const value = input.value.trim();
    if (!value) return;
    localStorage.setItem('username_demo', value);
    out.textContent = 'Hello, ' + value + '!';

    // fire-and-forget push to shared list
    try {
      const endpoint = '/.netlify/functions/usernames';
      await fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: value })
      });
      refreshBar();
    } catch (err) {
      // ignore; still works locally without the backend
    }
  });

  // Live preview as the user types
  input.addEventListener('input', function() {
    const value = input.value.trim();
    out.textContent = value ? 'Hello, ' + value + '!' : '';
  });

  // initial load
  refreshBar();
})();
</script>
<noscript>This page needs JavaScript enabled.</noscript>
</body>
</html>
